{% extends "base.html" %}

{% block body_class %}no-crt{% endblock %}

{% block title %}{{ page.title }} - {{ config.title }}{% endblock %}

{% block description %}{% if page.description %}{{ page.description | truncate(length=160) }}{% elif page.summary %}{{ page.summary | striptags | truncate(length=160) }}{% else %}{{ config.description }}{% endif %}{% endblock %}

{% block canonical %}{{ page.permalink }}{% endblock %}

{% block katex %}
{% if page.extra.math %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.27/dist/katex.min.css" integrity="sha384-Pu5+C18nP5dwykLJOhd2U4Xen7rjScHN/qusop27hdd2drI+lL5KvX7YntvT8yew" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.27/dist/katex.min.js" integrity="sha384-2B8pfmZZ6JlVoScJm/5hQfNS2TI/6hPqDZInzzPc8oHpN5SgeNOf4LzREO6p5YtZ" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.27/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
{% endif %}
{% endblock katex %}

{% block og_tags %}
<meta property="og:type" content="article">
<meta property="og:title" content="{{ page.title }}">
<meta property="og:description" content="{% if page.description %}{{ page.description | truncate(length=160) }}{% elif page.summary %}{{ page.summary | striptags | truncate(length=160) }}{% else %}{{ config.description }}{% endif %}">
<meta property="og:url" content="{{ page.permalink }}">
{% if page.extra.feature_image %}<meta property="og:image" content="{{ page.extra.feature_image }}">{% endif %}
<meta property="article:published_time" content="{{ page.date }}">
{% if page.updated %}<meta property="article:modified_time" content="{{ page.updated }}">{% endif %}
{% if page.taxonomies.tags %}{% for tag in page.taxonomies.tags %}<meta property="article:tag" content="{{ tag }}">
{% endfor %}{% endif %}
{% endblock og_tags %}

{% block twitter_tags %}
<meta name="twitter:title" content="{{ page.title }}">
<meta name="twitter:description" content="{% if page.description %}{{ page.description | truncate(length=160) }}{% elif page.summary %}{{ page.summary | striptags | truncate(length=160) }}{% else %}{{ config.description }}{% endif %}">
{% if page.extra.feature_image %}<meta name="twitter:image" content="{{ page.extra.feature_image }}">{% endif %}
{% endblock twitter_tags %}

{% block content %}
<div class="reading-progress" id="reading-progress"></div>
<article class="post-article">
    <header class="post-header">
        {% if page.extra.feature_image %}
        <div class="post-hero-image">
            <img src="{{ page.extra.feature_image }}" alt="{{ page.title }}">
        </div>
        {% endif %}

        <div class="post-header-content">
            {% if page.taxonomies.tags %}
            <div class="post-categories">
                {% for tag in page.taxonomies.tags | slice(end=2) %}
                <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}" class="category-link">{{ tag }}</a>
                {% endfor %}
            </div>
            {% endif %}

            <h1 class="post-title">{{ page.title }}</h1>

            <div class="post-meta">
                {% if page.extra.authors %}
                <span class="post-authors">
                    {% for author in page.extra.authors %}{{ author }}{% if not loop.last %}, {% endif %}{% endfor %}
                </span>
                {% endif %}
                <time datetime="{{ page.date }}">{{ page.date | date(format="%B %d, %Y") }}</time>
                {% if page.reading_time %}
                <span class="reading-time">{{ page.reading_time }} min read</span>
                {% endif %}
            </div>
        </div>
    </header>

    <div class="post-content prose">
        {{ page.content | safe }}
    </div>

    <footer class="post-footer">
        {% if page.taxonomies.tags %}
        <div class="post-tags-footer">
            <span class="tags-label">Topics:</span>
            {% for tag in page.taxonomies.tags %}
            <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}" class="tag">{{ tag }}</a>
            {% endfor %}
        </div>
        {% endif %}

        <nav class="post-navigation">
            {% if page.earlier %}
            <a href="{{ page.earlier.permalink }}" class="nav-link prev">
                <span class="nav-label">Previous Article</span>
                <span class="nav-title">{{ page.earlier.title | truncate(length=50) }}</span>
            </a>
            {% endif %}
            {% if page.later %}
            <a href="{{ page.later.permalink }}" class="nav-link next">
                <span class="nav-label">Next Article</span>
                <span class="nav-title">{{ page.later.title | truncate(length=50) }}</span>
            </a>
            {% endif %}
        </nav>
    </footer>
</article>

<script>
(function() {
    const progressBar = document.getElementById('reading-progress');
    const article = document.querySelector('.post-article');

    function updateProgress() {
        const articleRect = article.getBoundingClientRect();
        const articleTop = window.scrollY + articleRect.top;
        const articleHeight = articleRect.height;
        const windowHeight = window.innerHeight;
        const scrolled = window.scrollY - articleTop + windowHeight;
        const progress = Math.min(Math.max(scrolled / articleHeight * 100, 0), 100);
        progressBar.style.width = progress + '%';
    }

    window.addEventListener('scroll', updateProgress, { passive: true });
    window.addEventListener('resize', updateProgress, { passive: true });
    updateProgress();
})();
</script>
{% endblock %}
